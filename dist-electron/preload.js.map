{"version":3,"file":"preload.js","sources":["../electron/preload.ts"],"sourcesContent":["/// <reference types=\"electron\" />\nimport { contextBridge, ipcRenderer } from 'electron';\n\n// API exposed to renderer process\ncontextBridge.exposeInMainWorld('electronAPI', {\n  // Basic info and communication functions\n  isElectron: true,\n  platform: process.platform,\n  \n  // Send message to main process\n  send: (channel: string, data?: any) => {\n    const validChannels = [\n      'telemetry:update',\n      'telemetry:connectionChange',\n      'widget:closeByEscape',\n      'widget:registerForUpdates'\n    ];\n    \n    if (validChannels.includes(channel)) {\n      ipcRenderer.send(channel, data);\n    } else {\n      console.warn(`Channel ${channel} is not allowed for sending`);\n    }\n  },\n  \n  // Add event listener to receive messages from main process\n  on: (channel: string, callback: (data: any) => void) => {\n    const validChannels = [\n      'main-process-message', \n      'app:toggle-click-through',\n      'app:initial-state',\n      'display:id'\n    ];\n    if (validChannels.includes(channel)) {\n      // Deliberately strip event as it includes `sender` \n      const subscription = (_event: any, data: any) => callback(data);\n      ipcRenderer.on(channel, subscription);\n      \n      return () => {\n        ipcRenderer.removeListener(channel, subscription);\n      };\n    }\n  },\n  \n  // Remove all listeners for a channel\n  removeAllListeners: (channel: string) => {\n    const validChannels = [\n      'main-process-message', \n      'app:toggle-click-through', \n      'app:initial-state',\n      'display:id'\n    ];\n    if (validChannels.includes(channel)) {\n      ipcRenderer.removeAllListeners(channel);\n    }\n  },\n  \n  // Invoke a function in the main process\n  invoke: async (channel: string, data?: any): Promise<any> => {\n    const validChannels = [\n      'app:quit', \n      'app:toggleClickThrough',\n      'app:getCurrentDisplayId',\n      'app:getUserDataPath',\n      'config:save',\n      'config:load',\n      'config:list',\n      'debug:listConfigFiles'\n    ];\n    \n    if (validChannels.includes(channel)) {\n      return await ipcRenderer.invoke(channel, data);\n    }\n    \n    throw new Error(`Invoke not allowed for channel: ${channel}`);\n  },\n\n  // Application control functions\n  app: {\n    // Quit the application\n    quit: async (): Promise<any> => {\n      return await ipcRenderer.invoke('app:quit');\n    },\n    \n    // Toggle click-through mode\n    toggleClickThrough: async (state: boolean): Promise<any> => {\n      console.log(`Preload: Requesting toggleClickThrough with state=${state}`);\n      try {\n        const result = await ipcRenderer.invoke('app:toggleClickThrough', state);\n        console.log('Preload: Toggle response received:', result);\n        return result;\n      } catch (error) {\n        console.error('Preload: Error in toggleClickThrough:', error);\n        throw error;\n      }\n    },\n\n    // Get current display ID\n    getCurrentDisplayId: async (): Promise<any> => {\n      return await ipcRenderer.invoke('app:getCurrentDisplayId');\n    },\n\n    // Get user data path\n    getUserDataPath: async (): Promise<string> => {\n      return await ipcRenderer.invoke('app:getUserDataPath');\n    }\n  },\n\n  // Configuration API\n  config: {\n    // Save a configuration\n    saveConfig: async (type: string, name: string, data: any): Promise<boolean> => {\n      try {\n        return await ipcRenderer.invoke('config:save', type, name, data);\n      } catch (error) {\n        console.error('Error saving config:', error);\n        return false;\n      }\n    },\n    \n    // Load a configuration\n    loadConfig: async (type: string, name: string): Promise<any> => {\n      try {\n        return await ipcRenderer.invoke('config:load', type, name);\n      } catch (error) {\n        console.error('Error loading config:', error);\n        return null;\n      }\n    },\n    \n    // List available configurations\n    listConfigs: async (type: string): Promise<string[]> => {\n      try {\n        return await ipcRenderer.invoke('config:list', type);\n      } catch (error) {\n        console.error('Error listing configs:', error);\n        return [];\n      }\n    }\n  },\n\n  // Debug API\n  debug: {\n    // List all config files\n    listConfigFiles: async (): Promise<any> => {\n      return await ipcRenderer.invoke('debug:listConfigFiles');\n    }\n  }\n});\n\n// Expose speech synthesis API to renderer process\ncontextBridge.exposeInMainWorld('electronSpeech', {\n  // Get available voices\n  getVoices: async (): Promise<string[]> => {\n    try {\n      return await ipcRenderer.invoke('speech:getVoices');\n    } catch (error) {\n      console.error('Error getting voices:', error);\n      return [];\n    }\n  },\n  \n  // Speak text with specified voice and parameters\n  speak: async (text: string, voice?: string, rate?: number, volume?: number): Promise<any> => {\n    try {\n      console.log(`Preload: Speaking \"${text}\" with voice=${voice}, rate=${rate}, volume=${volume}`);\n      return await ipcRenderer.invoke('speech:speak', text, voice, rate, volume);\n    } catch (error) {\n      console.error('Error speaking:', error);\n      throw error;\n    }\n  },\n  \n  // Stop speech\n  stop: async (id?: number): Promise<any> => {\n    try {\n      return await ipcRenderer.invoke('speech:stop', id);\n    } catch (error) {\n      console.error('Error stopping speech:', error);\n      throw error;\n    }\n  },\n  \n  // Add listener for speech completion\n  onSpeechComplete: (callback: (data: {id: number}) => void) => {\n    const wrappedCallback = (_event: any, data: {id: number}) => callback(data);\n    ipcRenderer.on('speech:complete', wrappedCallback);\n    return () => {\n      ipcRenderer.removeListener('speech:complete', wrappedCallback);\n    };\n  },\n  \n  // Add listener for speech errors\n  onSpeechError: (callback: (data: {id: number, error: string}) => void) => {\n    const wrappedCallback = (_event: any, data: {id: number, error: string}) => callback(data);\n    ipcRenderer.on('speech:error', wrappedCallback);\n    return () => {\n      ipcRenderer.removeListener('speech:error', wrappedCallback);\n    };\n  }\n});\n\n// Log when preload script has completed\nconsole.log('Preload script executed successfully');\n"],"names":[],"mappings":"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"}